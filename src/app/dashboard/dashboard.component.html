<div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-6xl mx-auto">
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <!-- Header -->
      <header class="px-8 py-6 border-b">
        <h1 class="text-2xl sm:text-3xl font-extrabold text-slate-800">
          Darshan Attender Console
        </h1>
        <p class="mt-2 text-sm text-slate-600">
          Welcome back,
          <span class="text-blue-600 font-semibold">{{ user.name }} (ID: {{ user.id }})</span>.
          Here is your current devotee roster.
        </p>
      </header>

      <!-- Body -->
      <main class="bg-amber-50 p-8">
        <h2 class="text-lg font-semibold text-slate-800 mb-6">
          My Duties - {{ todayLabel }}
        </h2>

<!-- Stats cards -->
<div class="grid gap-4 grid-cols-1 sm:grid-cols-3 mb-8">
  <div class="relative bg-white rounded-xl p-5 shadow-md">
    <div class="text-sm text-slate-500">Assigned Today (Active)</div>
    <div class="mt-3 flex items-center justify-between">
      <div class="text-3xl font-extrabold text-blue-600">{{ activeAssigned }}</div>
    </div>
  </div>

  <div class="relative bg-white rounded-xl p-5 shadow-md">
    <div class="text-sm text-slate-500">Exit Today</div>
    <div class="mt-3 flex items-center justify-between">
      <div class="text-3xl font-extrabold text-green-600">{{ marked_exit_schedules }}</div>
    </div>
  </div>

  <div class="relative bg-white rounded-xl p-5 shadow-md">
    <div class="text-sm text-slate-500">Total Devotees Attended</div>
    <div class="mt-3 flex items-center justify-between">
      <div class="text-3xl font-extrabold text-slate-800">{{ total_schedules }}</div>
    </div>
  </div>
</div>


        <!-- Active Assigned Devotees -->
<!-- Active Assigned Devotees -->
<section>
  <h3 class="text-slate-800 font-semibold mb-3">Active Assigned Devotees</h3>

  <div class="bg-white rounded-lg shadow overflow-x-auto">
<!-- Header -->
<div
  class="hidden md:grid grid-cols-[1.1fr_1.3fr_1.4fr_1.3fr_1.1fr_1.2fr_1.2fr] items-center bg-slate-100 
         text-slate-700 text-sm font-semibold px-8 py-3 border-b"
>
  <div>Booking ID</div>
  <div>Darshan Type</div>
  <div>Primary Devotee</div>
  <div>Date</div>
  <div>Group Size</div>
  <div>Status</div>
  <div class="text-right pr-6">Actions</div> <!-- moves content ~1cm left -->
</div>

<!-- Rows -->
<div class="divide-y">
  <div
    *ngFor="let d of devotees"
    class="grid grid-cols-[1.1fr_1.3fr_1.4fr_1.3fr_1.1fr_1.2fr_1.2fr] items-center px-8 py-4 hover:bg-slate-50 transition"
  >
    <div>
      <a
        href="#"
        class="text-blue-600 font-semibold hover:underline"
        (click)="$event.preventDefault(); openDetails(d)"
      >
        {{ d.appointment }}
      </a>
    </div>
    <div class="text-slate-700">{{ d.appointment_type }}</div>
    <div class="font-semibold text-slate-800 truncate">{{ d.primary_devoteee_name }}</div>
    <div class="text-slate-600">{{ d.appointment_date }}</div>
    <div class="text-slate-600">{{ d.group_size }} Devotee(s)</div>
    <div>
      <span
        class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium"
        [ngClass]="{
          'bg-green-100 text-green-700':
            (d.mark_exit + '') === '0' || (d.mark_exit + '').toLowerCase() === 'no',
          'bg-red-100 text-red-700':
            (d.mark_exit + '') === '1' || (d.mark_exit + '').toLowerCase() === 'yes'
        }"
      >
        <span
          class="w-2 h-2 rounded-full"
          [ngClass]="{
            'bg-green-500':
              (d.mark_exit + '') === '0' || (d.mark_exit + '').toLowerCase() === 'no',
            'bg-red-500':
              (d.mark_exit + '') === '1' || (d.mark_exit + '').toLowerCase() === 'yes'
          }"
        ></span>

        {{
          (d.mark_exit + '') === '1' || (d.mark_exit + '').toLowerCase() === 'yes'
            ? 'Inactive'
            : 'Active'
        }}
      </span>
    </div>
    <div class="flex justify-end">
      <button
        class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-full bg-blue-600 text-white hover:bg-blue-700 shadow-sm"
        (click)="openDetails(d)"
      >
        View Details
      </button>
    </div>
  </div>
</div>

  </div>

  <div class="mt-6">
    <button (click)="logout()"
      class="px-4 py-2 rounded-lg bg-slate-500 text-white hover:bg-slate-600 shadow"
    >
      Logout
    </button>
  </div>
</section>


      </main>
    </div>
  </div>
</div>

<!-- Modal -->
<div *ngIf="showModal && current" class="fixed inset-0 z-50 flex items-center justify-center">
  <div class="absolute inset-0 bg-black/40" (click)="closeModal()"></div>

  <div class="relative w-full max-w-3xl mx-4">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
      <!-- Header -->
      <div class="px-8 py-5 border-b flex items-start justify-between">
        <div>
          <h4 class="text-lg sm:text-xl font-semibold text-slate-800">
            Booking #{{ current.appointment }}
          </h4>
          <p class="text-sm text-slate-600 mt-1">
            {{ current.type }} • {{ current.date }}
          </p>
        </div>
        <button class="text-slate-400 hover:text-slate-600 text-lg" (click)="closeModal()">✕</button>
      </div>

      <!-- Body -->
      <div class="px-8 py-6 space-y-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Primary Devotee</dt>
            <dd class="font-semibold text-slate-800">{{ current.primary }}</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Group Size</dt>
            <dd class="font-semibold text-slate-800">{{ current.groupSize }} Devotee(s)</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Mark Exit</dt>
            <dd class="font-semibold text-green-700">{{ current.mark_exit || 'Not marked' }}</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Start Time</dt>
            <dd class="font-semibold text-slate-800">{{ current.start_time || 'N/A' }}</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">End Time</dt>
            <dd class="font-semibold text-slate-800">{{ current.end_time || 'N/A' }}</dd>
          </div>
        </div>

        <div>
          <dt class="text-xs text-slate-500 uppercase tracking-wide">Notes</dt>
          <dd class="mt-1 text-slate-700">{{ current.notes || 'No additional notes.' }}</dd>
        </div>

<!-- Companions Section -->
<div>
  <dt class="text-xs text-slate-500 uppercase tracking-wide mb-2">Companions</dt>

  <!-- Companions list (if available) -->
  <div
    *ngIf="current.companions && current.companions.length > 0; else noCompanions"
    class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
  >
    <div
      *ngFor="let c of current.companions; let i = index"
      class="border border-slate-200 rounded-2xl bg-gradient-to-br from-slate-50 to-white shadow-sm hover:shadow-md transition-shadow p-5"
    >
      <div class="flex items-start gap-3">
        <div
          class="bg-blue-100 text-blue-700 font-bold text-sm rounded-full w-8 h-8 flex items-center justify-center"
        >
          {{ i + 1 }}
        </div>
        <div class="flex-1">
          <p class="text-base font-semibold text-slate-800">
            {{ c.name || 'Unnamed Companion' }}
          </p>
          <p class="text-sm text-slate-600 mt-1">
            Gender:
            <span class="font-medium">{{ c.gender || 'N/A' }}</span>
          </p>
          <p class="text-sm text-slate-600">
            Age:
            <span class="font-medium">{{ c.age || 'N/A' }}</span>
          </p>
          <p class="text-sm text-slate-600">
            Phone:
            <span class="font-medium">{{ c.phone || 'N/A' }}</span>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- No companions message -->
  <ng-template #noCompanions>
    <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl text-slate-600 text-sm italic">
      No companions listed.
    </div>
  </ng-template>
</div>



      </div>

      <!-- Footer -->
<!-- Footer -->
<div class="px-8 py-5 bg-slate-50 flex items-center justify-end gap-3">
  <button
  *ngIf="current?.mark_exit === 'No'"
  class="px-6 py-2.5 rounded-md bg-green-600 text-white hover:bg-green-700 shadow transition font-medium"
  (click)="markExit(current.appointment)"
>
  Mark Exit
</button>

</div>

    </div>
  </div>
</div>
