<div class="min-h-screen bg-gradient-to-br from-orange-50 via-white to-amber-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">

    <!-- Header -->
    <header class="mb-8 animate-slide-up">
      <div class="bg-gradient-mahakal rounded-2xl shadow-mahakal p-8 text-white">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <div>
            <h1 class="text-3xl sm:text-4xl font-bold font-poppins mb-2">
              üïâÔ∏è Attender Dashboard
            </h1>
            <p class="text-lg opacity-90">
              Welcome back, <span class="font-semibold">{{ user.name }}</span> (ID: {{ user.id }})
            </p>
            <p class="text-sm opacity-75 mt-1">{{ todayLabel }}</p>
          </div>
          <div class="flex items-center gap-3">
            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center animate-float">
              <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Stats Cards -->
    <div class="grid gap-6 grid-cols-1 sm:grid-cols-3 mb-8 animate-scale-in">
      <!-- Active Assigned -->
      <div
        class="relative bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border-t-4 border-mahakal-orange">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">Active Today</div>
            <div class="text-4xl font-bold text-mahakal-orange">{{ activeAssigned }}</div>
            <div class="text-xs text-gray-500 mt-1">Devotees assigned</div>
          </div>
          <div
            class="w-16 h-16 bg-gradient-to-br from-mahakal-saffron to-mahakal-orange rounded-full flex items-center justify-center shadow-md">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Exit Today -->
      <div
        class="relative bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border-t-4 border-green-500">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">Completed</div>
            <div class="text-4xl font-bold text-green-600">{{ marked_exit_schedules }}</div>
            <div class="text-xs text-gray-500 mt-1">Marked exit today</div>
          </div>
          <div
            class="w-16 h-16 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center shadow-md">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Total Devotees -->
      <div
        class="relative bg-white rounded-2xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 border-t-4 border-temple-blue">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">Total</div>
            <div class="text-4xl font-bold text-temple-blue">{{ total_schedules }}</div>
            <div class="text-xs text-gray-500 mt-1">All devotees</div>
          </div>
          <div class="w-16 h-16 bg-gradient-temple rounded-full flex items-center justify-center shadow-md">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
      <!-- Daily Bookings Trend -->
      <div class="lg:col-span-2 bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
            <svg class="w-5 h-5 text-mahakal-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" />
            </svg>
            Daily Bookings Trend
          </h3>
          <span class="text-xs text-gray-500 bg-gray-100 px-3 py-1 rounded-full">Last 7 Days</span>
        </div>
        <div class="h-64">
          <canvas id="dailyChart"></canvas>
        </div>
      </div>

      <!-- Darshan Type Distribution -->
      <div class="bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
            <svg class="w-5 h-5 text-mahakal-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
            </svg>
            Darshan Types
          </h3>
        </div>
        <div class="h-64">
          <canvas id="darshanChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Monthly Statistics -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 hover:shadow-xl transition-shadow duration-300">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-900 flex items-center gap-2">
          <svg class="w-5 h-5 text-mahakal-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
          </svg>
          Monthly Statistics
        </h3>
        <span class="text-xs text-gray-500 bg-gray-100 px-3 py-1 rounded-full">Last 6 Months</span>
      </div>
      <div class="h-72">
        <canvas id="monthlyChart"></canvas>
      </div>
    </div>

    <!-- Main Content -->
    <main class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <div class="px-8 py-6 bg-gradient-to-r from-gray-50 to-white border-b">
        <h2 class="text-2xl font-bold text-gray-900">
          Active Assigned Devotees
        </h2>
        <p class="text-sm text-gray-600 mt-1">Manage your current devotee roster</p>
      </div>

      <!-- Active Assigned Devotees Section -->
      <section class="p-8">
        <div class="bg-white rounded-lg shadow overflow-x-auto">
          <!-- Header -->
          <div class="hidden md:grid grid-cols-[1.1fr_1.3fr_1.4fr_1.3fr_1.1fr_1.2fr_1.2fr] items-center bg-slate-100 
         text-slate-700 text-sm font-semibold px-8 py-3 border-b">
            <div>Booking ID</div>
            <div>Darshan Type</div>
            <div>Primary Devotee</div>
            <div>Date</div>
            <div>Group Size</div>
            <div>Status</div>
            <div class="text-right pr-6">Actions</div> <!-- moves content ~1cm left -->
          </div>

          <!-- Rows -->
          <div class="divide-y">
            <div *ngFor="let d of devotees"
              class="grid grid-cols-[1.1fr_1.3fr_1.4fr_1.3fr_1.1fr_1.2fr_1.2fr] items-center px-8 py-4 hover:bg-slate-50 transition">
              <div>
                <a href="#" class="text-blue-600 font-semibold hover:underline"
                  (click)="$event.preventDefault(); openDetails(d)">
                  {{ d.appointment }}
                </a>
              </div>
              <div class="text-slate-700">{{ d.appointment_type }}</div>
              <div class="font-semibold text-slate-800 truncate">{{ d.primary_devoteee_name }}</div>
              <div class="text-slate-600">{{ d.appointment_date }}</div>
              <div class="text-slate-600">{{ d.group_size }} Devotee(s)</div>
              <div>
                <span class="inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium" [ngClass]="{
          'bg-green-100 text-green-700':
            (d.mark_exit + '') === '0' || (d.mark_exit + '').toLowerCase() === 'no',
          'bg-red-100 text-red-700':
            (d.mark_exit + '') === '1' || (d.mark_exit + '').toLowerCase() === 'yes'
        }">
                  <span class="w-2 h-2 rounded-full" [ngClass]="{
            'bg-green-500':
              (d.mark_exit + '') === '0' || (d.mark_exit + '').toLowerCase() === 'no',
            'bg-red-500':
              (d.mark_exit + '') === '1' || (d.mark_exit + '').toLowerCase() === 'yes'
          }"></span>

                  {{
                  (d.mark_exit + '') === '1' || (d.mark_exit + '').toLowerCase() === 'yes'
                  ? 'Inactive'
                  : 'Active'
                  }}
                </span>
              </div>
              <div class="flex justify-end">
                <button
                  class="inline-flex items-center px-4 py-2 text-sm font-medium rounded-full bg-blue-600 text-white hover:bg-blue-700 shadow-sm"
                  (click)="openDetails(d)">
                  View Details
                </button>
              </div>
            </div>
          </div>

        </div>

        <div class="mt-6">
          <!-- <button (click)="logout()"
      class="px-4 py-2 rounded-lg bg-slate-500 text-white hover:bg-slate-600 shadow"
    >
      Logout
    </button> -->
        </div>
      </section>




    </main>
  </div>
</div>


<!-- Modal -->
<div *ngIf="showModal && current" class="fixed inset-0 z-50 flex items-center justify-center">
  <div class="absolute inset-0 bg-black/40" (click)="closeModal()"></div>

  <div class="relative w-full max-w-3xl mx-4">
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
      <!-- Header -->
      <div class="px-8 py-5 border-b flex items-start justify-between">
        <div>
          <h4 class="text-lg sm:text-xl font-semibold text-slate-800">
            Booking #{{ current.appointment }}
          </h4>
          <p class="text-sm text-slate-600 mt-1">
            {{ current.type }} ‚Ä¢ {{ current.date }}
          </p>
        </div>
        <button class="text-slate-400 hover:text-slate-600 text-lg" (click)="closeModal()">‚úï</button>
      </div>

      <!-- Body -->
      <div class="px-8 py-6 space-y-6">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Primary Devotee</dt>
            <dd class="font-semibold text-slate-800">{{ current.primary }}</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Group Size</dt>
            <dd class="font-semibold text-slate-800">{{ current.groupSize }} Devotee(s)</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Mark Exit</dt>
            <dd class="font-semibold text-green-700">{{ current.mark_exit || 'Not marked' }}</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">Start Time</dt>
            <dd class="font-semibold text-slate-800">{{ current.start_time || 'N/A' }}</dd>
          </div>

          <div>
            <dt class="text-xs text-slate-500 uppercase tracking-wide">End Time</dt>
            <dd class="font-semibold text-slate-800">{{ current.end_time || 'N/A' }}</dd>
          </div>
        </div>

        <div>
          <dt class="text-xs text-slate-500 uppercase tracking-wide">Notes</dt>
          <dd class="mt-1 text-slate-700">{{ current.notes || 'No additional notes.' }}</dd>
        </div>

        <!-- Companions Section -->
        <div>
          <dt class="text-xs text-slate-500 uppercase tracking-wide mb-2">Companions</dt>

          <!-- Companions list (if available) -->
          <div *ngIf="current.companions && current.companions.length > 0; else noCompanions"
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div *ngFor="let c of current.companions; let i = index"
              class="border border-slate-200 rounded-2xl bg-gradient-to-br from-slate-50 to-white shadow-sm hover:shadow-md transition-shadow p-5">
              <div class="flex items-start gap-3">
                <div
                  class="bg-blue-100 text-blue-700 font-bold text-sm rounded-full w-8 h-8 flex items-center justify-center">
                  {{ i + 1 }}
                </div>
                <div class="flex-1">
                  <p class="text-base font-semibold text-slate-800">
                    {{ c.name || 'Unnamed Companion' }}
                  </p>
                  <p class="text-sm text-slate-600 mt-1">
                    Gender:
                    <span class="font-medium">{{ c.gender || 'N/A' }}</span>
                  </p>
                  <p class="text-sm text-slate-600">
                    Age:
                    <span class="font-medium">{{ c.age || 'N/A' }}</span>
                  </p>
                  <p class="text-sm text-slate-600">
                    Phone:
                    <span class="font-medium">{{ c.phone || 'N/A' }}</span>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- No companions message -->
          <ng-template #noCompanions>
            <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl text-slate-600 text-sm italic">
              No companions listed.
            </div>
          </ng-template>
        </div>



      </div>

      <!-- Footer -->
      <!-- Footer -->
      <div class="px-8 py-5 bg-slate-50 flex items-center justify-end gap-3">
        <button *ngIf="current?.mark_exit === 'No'"
          class="px-6 py-2.5 rounded-md bg-green-600 text-white hover:bg-green-700 shadow transition font-medium"
          (click)="markExit(current.appointment)">
          Mark Exit
        </button>

      </div>

    </div>
  </div>
</div>